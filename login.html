<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Iniciar sesión</title>

<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link href="css/style.css" id="cssFile" rel="stylesheet" type="text/css">
</head>
	<body>
		<div class="login-form">
			<h1>INICIAR SESIÓN</h1>
			<form>
				<input type="email" name="usermail" placeholder="Mail" required>
				<input type="password" name="password" placeholder="Contraseña" required>
				<input type="button" name="inglink" value="INGRESAR">
                <input type="button" class="reglink" name="reglink" value="REGISTRARSE">
			</form>
		</div>
    <script>

//var request = new Request('http://localhost:3000/login', {
//        method: 'GET',
//        mode: 'cors',
//        credentials: 'omit',
//        cache: 'only-if-cached',
//        referrerPolicy: 'no-referrer'
//    });
let datos = {
    email_login: $('input[name="usermail"]').val(),
    pass_login: $('input[name="password"]').val()
};

//var request = new Request('http://localhost:3000/login', {
//        method: 'POST',
//        headers: new Headers({ 'Content-Type': 'application/json' }),
//        body: JSON.stringify(datos)
//    });
//    fetch(request)
//        .then(function(response) {
//            response.json()
//                .then(function(datos) {
//                    console.log(datos);
//                    that.loginUser(datos);
//            });
//        });


//    fetch(request)
//        .then(function(response) {
//            response.json()
//                .then(function(data) {
//                    console.log(data);
//
//                });
//            });
//
//            console.log('response =', response);
//            return response.text();

//        .then(function(data) {
//            console.log('data = ', data);
//        })
//        .catch(function(err) {
//            console.error(err);
//        });


    $(document).ready(function() {
        $('input[name="inglink"]').click(function() {
            //Enviar datos de login con función Request POST
            datos.email_login = $('input[name="usermail"]').val();
            datos.pass_login = $('input[name="password"]').val();

            var request = new Request('http://localhost:3000/login', {
                    method: 'POST',
                    headers: new Headers({ 'Content-Type': 'application/json' }),
                    body: JSON.stringify(datos)
                });

                //xmlhttprequest
                //Si el usuario es erroneo o la contraseña es incorrecta muestra mensaje en pantalla
                //Si no redirige a la pantalla home
//                fetch(request)
//                    .then(function(response) {
//                        response.json()
//                            .then(function(data) {
//                                console.log(data);
//                            })
//                            .catch(function(err) {
//                                console.error(err);
//                            });
//                    })
//                    .catch(function(err) {
//                        console.error(err);
//                    });
                fetch(request)
                    .then(function(response) {
                        console.log('response =', response);
                        return response.json();
                    })
                    .then(function(data) {
                        console.log('data = ', data);
                        window.location = '/home';
                    })
                    .catch(function(err) {
                        console.error(err);
                    });
        });
        $(".reglink").click(function() {
            window.location = '/register';
        });
    });
    </script>
	</body>
</html>
